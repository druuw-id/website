"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[867],{26867:(t,e,r)=>{r.r(e),r.d(e,{_HDRTextureLoader:()=>n});var a=r(18002);class n{constructor(){this.supportCascades=!1}loadCubeData(){throw".hdr not supported in Cube."}loadData(t,e,r){const n=new Uint8Array(t.buffer,t.byteOffset,t.byteLength),o=(0,a.NK)(n),h=(0,a.LT)(n,o),i=o.width*o.height,c=new Float32Array(4*i);for(let t=0;t<i;t+=1)c[4*t]=h[3*t],c[4*t+1]=h[3*t+1],c[4*t+2]=h[3*t+2],c[4*t+3]=1;r(o.width,o.height,e.generateMipMaps,!1,(()=>{const t=e.getEngine();e.type=1,e.format=5,e._gammaSpace=!1,t._uploadDataToTextureDirectly(e,c)}))}}},18002:(t,e,r)=>{r.d(e,{I9:()=>u,LT:()=>c,NK:()=>h,VH:()=>i});var a=r(14875);function n(t,e,r,a,n,o){n>0?(n=function(t,e){return e>1023?1*Math.pow(2,1023)*Math.pow(2,e-1023):e<-1074?1*Math.pow(2,-1074)*Math.pow(2,e+1074):1*Math.pow(2,e)}(0,n-136),t[o+0]=e*n,t[o+1]=r*n,t[o+2]=a*n):(t[o+0]=0,t[o+1]=0,t[o+2]=0)}function o(t,e){let r="",a="";for(let n=e;n<t.length-e&&(a=String.fromCharCode(t[n]),"\n"!=a);n++)r+=a;return r}function h(t){let e=0,r=0,a=o(t,0);if("#"!=a[0]||"?"!=a[1])throw"Bad HDR Format.";let n=!1,h=!1,i=0;do{i+=a.length+1,a=o(t,i),"FORMAT=32-bit_rle_rgbe"==a?h=!0:0==a.length&&(n=!0)}while(!n);if(!h)throw"HDR Bad header format, unsupported FORMAT";i+=a.length+1,a=o(t,i);const c=/^-Y (.*) \+X (.*)$/g.exec(a);if(!c||c.length<3)throw"HDR Bad header format, no size";if(r=parseInt(c[2]),e=parseInt(c[1]),r<8||r>32767)throw"HDR Bad header format, unsupported size";return i+=a.length+1,{height:e,width:r,dataPosition:i}}function i(t,e,r=!1){const n=new Uint8Array(t),o=h(n),i=c(n,o);return a.D.ConvertPanoramaToCubemap(i,o.width,o.height,e,r)}function c(t,e){return function(t,e){let r=e.height;const a=e.width;let o,h,i,c,u,w=e.dataPosition,f=0,d=0,l=0;const C=new ArrayBuffer(4*a),p=new Uint8Array(C),g=new ArrayBuffer(e.width*e.height*4*3),m=new Float32Array(g);for(;r>0;){if(o=t[w++],h=t[w++],i=t[w++],c=t[w++],2!=o||2!=h||128&i||e.width<8||e.width>32767)return s(t,e);if((i<<8|c)!=a)throw"HDR Bad header format, wrong scan line width";for(f=0,l=0;l<4;l++)for(d=(l+1)*a;f<d;)if(o=t[w++],h=t[w++],o>128){if(u=o-128,0==u||u>d-f)throw"HDR Bad Format, bad scanline data (run)";for(;u-- >0;)p[f++]=h}else{if(u=o,0==u||u>d-f)throw"HDR Bad Format, bad scanline data (non-run)";if(p[f++]=h,--u>0)for(let e=0;e<u;e++)p[f++]=t[w++]}for(l=0;l<a;l++)o=p[l],h=p[l+a],i=p[l+2*a],c=p[l+3*a],n(m,o,h,i,c,(e.height-r)*a*3+3*l);r--}return m}(t,e)}function s(t,e){let r=e.height;const a=e.width;let o,h,i,c,s,u=e.dataPosition;const w=new ArrayBuffer(e.width*e.height*4*3),f=new Float32Array(w);for(;r>0;){for(s=0;s<e.width;s++)o=t[u++],h=t[u++],i=t[u++],c=t[u++],n(f,o,h,i,c,(e.height-r)*a*3+3*s);r--}return f}const u={RGBE_ReadHeader:h,GetCubeMapTextureData:i,RGBE_ReadPixels:c}},14875:(t,e,r)=>{r.d(e,{D:()=>n});var a=r(18159);class n{static ConvertPanoramaToCubemap(t,e,r,a,n=!1){if(!t)throw"ConvertPanoramaToCubemap: input cannot be null";if(t.length!=e*r*3)throw"ConvertPanoramaToCubemap: input size is wrong";return{front:this.CreateCubemapTexture(a,this.FACE_FRONT,t,e,r,n),back:this.CreateCubemapTexture(a,this.FACE_BACK,t,e,r,n),left:this.CreateCubemapTexture(a,this.FACE_LEFT,t,e,r,n),right:this.CreateCubemapTexture(a,this.FACE_RIGHT,t,e,r,n),up:this.CreateCubemapTexture(a,this.FACE_UP,t,e,r,n),down:this.CreateCubemapTexture(a,this.FACE_DOWN,t,e,r,n),size:a,type:1,format:4,gammaSpace:!1}}static CreateCubemapTexture(t,e,r,a,n,o=!1){const h=new ArrayBuffer(t*t*4*3),i=new Float32Array(h),c=o?Math.max(1,Math.round(a/4/t)):1,s=1/c,u=s*s,w=e[1].subtract(e[0]).scale(s/t),f=e[3].subtract(e[2]).scale(s/t),d=1/t;let l=0;for(let o=0;o<t;o++)for(let h=0;h<c;h++){let h=e[0],C=e[2];for(let e=0;e<t;e++)for(let s=0;s<c;s++){const c=C.subtract(h).scale(l).add(h);c.normalize();const s=this.CalcProjectionSpherical(c,r,a,n);i[o*t*3+3*e+0]+=s.r*u,i[o*t*3+3*e+1]+=s.g*u,i[o*t*3+3*e+2]+=s.b*u,h=h.add(w),C=C.add(f)}l+=d*s}return i}static CalcProjectionSpherical(t,e,r,a){let n=Math.atan2(t.z,t.x);const o=Math.acos(t.y);for(;n<-Math.PI;)n+=2*Math.PI;for(;n>Math.PI;)n-=2*Math.PI;let h=n/Math.PI;const i=o/Math.PI;h=.5*h+.5;let c=Math.round(h*r);c<0?c=0:c>=r&&(c=r-1);let s=Math.round(i*a);s<0?s=0:s>=a&&(s=a-1);const u=a-s-1;return{r:e[u*r*3+3*c+0],g:e[u*r*3+3*c+1],b:e[u*r*3+3*c+2]}}}n.FACE_LEFT=[new a.Vector3(-1,-1,-1),new a.Vector3(1,-1,-1),new a.Vector3(-1,1,-1),new a.Vector3(1,1,-1)],n.FACE_RIGHT=[new a.Vector3(1,-1,1),new a.Vector3(-1,-1,1),new a.Vector3(1,1,1),new a.Vector3(-1,1,1)],n.FACE_FRONT=[new a.Vector3(1,-1,-1),new a.Vector3(1,-1,1),new a.Vector3(1,1,-1),new a.Vector3(1,1,1)],n.FACE_BACK=[new a.Vector3(-1,-1,1),new a.Vector3(-1,-1,-1),new a.Vector3(-1,1,1),new a.Vector3(-1,1,-1)],n.FACE_DOWN=[new a.Vector3(1,1,-1),new a.Vector3(1,1,1),new a.Vector3(-1,1,-1),new a.Vector3(-1,1,1)],n.FACE_UP=[new a.Vector3(-1,-1,-1),new a.Vector3(-1,-1,1),new a.Vector3(1,-1,-1),new a.Vector3(1,-1,1)]}}]);